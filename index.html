<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type-Implicit C Editor</title>
  <style>
    body { margin: 0; font-family: sans-serif; }
    #editor { width: 100%; height: 95vh; font-family: monospace; font-size: 16px; padding: 10px; box-sizing: border-box; }
    .tooltip {
      position: absolute;
      background: #333;
      color: white;
      padding: 5px;
      border-radius: 4px;
      font-size: 12px;
      display: none;
      pointer-events: none;
    }
  </style>
</head>
<body>

<textarea id="editor">// Start typing C code
x = 5;
y = 3.14;
</textarea>

<div id="tooltip" class="tooltip"></div>

<script>
const editor = document.getElementById('editor');
const tooltip = document.getElementById('tooltip');

const basicTypes = ["int", "float", "char", "double", "void"];
let variableTypes = {};

// Find variables in the text
function findVariables(text) {
  const varRegex = /\b([a-zA-Z_][a-zA-Z0-9_]*)\b/g;
  const matches = new Set();
  let match;
  while ((match = varRegex.exec(text)) !== null) {
    const name = match[1];
    if (!basicTypes.includes(name)) {
      matches.add(name);
    }
  }
  return Array.from(matches);
}

// Save function (Ctrl+S)
function handleSave() {
  const vars = findVariables(editor.value);
  const untyped = vars.filter(v => !variableTypes[v]);
  if (untyped.length > 0) {
    alert("Missing types for: " + untyped.join(", "));
  } else {
    alert("All variables have types! âœ…");
    console.log("Saving with types:", variableTypes);
  }
}

// Show tooltip if hovering over variable
editor.addEventListener('mousemove', (e) => {
  const text = editor.value;
  const pos = editor.selectionStart;
  const lines = text.substring(0, pos).split("\n");
  const line = lines[lines.length - 1];
  const words = line.split(/\\s|\\W/);
  const lastWord = words[words.length - 1];

  if (variableTypes[lastWord]) {
    tooltip.innerHTML = "Type: " + variableTypes[lastWord];
    tooltip.style.left = e.pageX + 10 + "px";
    tooltip.style.top = e.pageY + 10 + "px";
    tooltip.style.display = "block";
  } else {
    tooltip.style.display = "none";
  }
});

// Click to select type
editor.addEventListener('click', (e) => {
  const text = editor.value;
  const pos = editor.selectionStart;
  const lines = text.substring(0, pos).split("\n");
  const line = lines[lines.length - 1];
  const words = line.split(/\\s|\\W/);
  const lastWord = words[words.length - 1];

  if (lastWord && !basicTypes.includes(lastWord)) {
    const type = prompt(`Select type for '${lastWord}':\\n${basicTypes.join(", ")}`);
    if (basicTypes.includes(type)) {
      variableTypes[lastWord] = type;
    }
  }
});

// Listen for Ctrl+S
window.addEventListener('keydown', (e) => {
  if (e.ctrlKey && e.key === 's') {
    e.preventDefault();
    handleSave();
  }
});

</script>

</body>
</html>
